<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pediatric Nursing Flashcards - Chapter 3: Hereditary Influences</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', 'Arial', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a237e 0%, #283593 100%);
            min-height: 100vh;
            padding: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }
        
        .container {
            width: 100%;
            max-width: 1200px;
            height: 96vh;
            background: #f5f7fa;
            border-radius: 20px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.25);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            border: 3px solid #3949ab;
        }
        
        .header {
            background: linear-gradient(135deg, #0d47a1, #1565c0);
            color: white;
            padding: 12px 15px;
            text-align: center;
            position: relative;
            overflow: hidden;
            flex-shrink: 0;
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" width="100" height="100" opacity="0.1"><path d="M50,5 Q70,20 85,40 Q100,60 85,80 Q70,100 50,95 Q30,100 15,80 Q0,60 15,40 Q30,20 50,5 Z" fill="white"/><path d="M50,15 Q65,25 75,40 Q85,55 75,70 Q65,85 50,85 Q35,85 25,70 Q15,55 25,40 Q35,25 50,15 Z" fill="white"/></svg>');
            background-size: 80px 80px;
        }
        
        .header h1 {
            font-size: 1.5rem;
            margin-bottom: 4px;
            position: relative;
            color: #e3f2fd;
            line-height: 1.2;
        }
        
        .header .subtitle {
            font-size: 0.9rem;
            opacity: 0.9;
            position: relative;
            color: #bbdefb;
            margin-bottom: 8px;
        }
        
        .progress {
            background: #0d47a1;
            height: 6px;
            width: 100%;
            flex-shrink: 0;
            border-radius: 0 0 5px 5px;
        }
        
        .progress-bar {
            background: linear-gradient(90deg, #3949ab, #5c6bc0);
            height: 100%;
            width: 0%;
            transition: width 0.4s ease;
            border-radius: 0 5px 5px 0;
        }
        
        .section-nav {
            display: flex;
            gap: 6px;
            padding: 8px 10px;
            background: linear-gradient(135deg, #1565c0, #0d47a1);
            border-bottom: 1px solid #3949ab;
            flex-shrink: 0;
            overflow-x: auto;
            align-items: center;
            justify-content: center;
        }
        
        .section-btn {
            padding: 5px 10px;
            border: 2px solid #3949ab;
            background: rgba(255,255,255,0.95);
            color: #0d47a1;
            border-radius: 15px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-size: 0.75rem;
            white-space: nowrap;
            flex-shrink: 0;
            min-width: 120px;
            text-align: center;
        }
        
        .section-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(57, 73, 171, 0.4);
        }
        
        .section-btn.active {
            background: linear-gradient(135deg, #3949ab, #5c6bc0);
            color: white;
            border-color: #0d47a1;
            box-shadow: 0 6px 12px rgba(57, 73, 171, 0.5);
        }
        
        .flashcard {
            padding: 12px;
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #f5f7fa;
            overflow: hidden;
            min-height: 0;
        }
        
        .question-container {
            display: flex;
            gap: 10px;
            align-items: flex-start;
            margin-bottom: 8px;
            background: white;
            padding: 12px;
            border-radius: 10px;
            border-left: 6px solid #3949ab;
            box-shadow: 0 4px 8px rgba(0,0,0,0.08);
            flex-shrink: 0;
        }
        
        .question-icon {
            background: linear-gradient(135deg, #0d47a1, #3949ab);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            font-weight: bold;
            flex-shrink: 0;
            box-shadow: 0 4px 8px rgba(13, 71, 161, 0.4);
        }
        
        .question {
            font-size: 0.9rem;
            line-height: 1.4;
            color: #2c3e50;
            flex-grow: 1;
            font-weight: 500;
            overflow-wrap: break-word;
            hyphens: auto;
        }
        
        .multiple-select-indicator {
            background: #d32f2f;
            color: white;
            padding: 3px 8px;
            border-radius: 15px;
            font-size: 0.7rem;
            font-weight: bold;
            margin-left: 6px;
            white-space: nowrap;
            box-shadow: 0 3px 6px rgba(211, 47, 47, 0.3);
            flex-shrink: 0;
        }
        
        .options {
            display: flex;
            flex-direction: column;
            gap: 6px;
            margin-bottom: 8px;
            flex: 1;
            overflow: hidden;
            min-height: 0;
        }
        
        .option {
            padding: 8px 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
            display: flex;
            align-items: flex-start;
            gap: 10px;
            font-size: 0.85rem;
            line-height: 1.3;
            flex-shrink: 0;
            min-height: 45px;
        }
        
        .option:hover {
            background: #e8eaf6;
            border-color: #7986cb;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(121, 134, 203, 0.2);
        }
        
        .option-letter {
            background: #e8eaf6;
            color: #0d47a1;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
            transition: all 0.3s ease;
            font-size: 0.8rem;
            border: 2px solid #c5cae9;
        }
        
        /* CORRECT - ALWAYS GREEN */
        .option.correct {
            background: #e8f5e9;
            border-color: #4caf50;
            color: #2e7d32;
        }
        
        .option.correct .option-letter {
            background: #4caf50;
            color: white;
            border-color: #4caf50;
        }
        
        /* INCORRECT - ALWAYS RED */
        .option.incorrect {
            background: #ffebee;
            border-color: #f44336;
            color: #c62828;
        }
        
        .option.incorrect .option-letter {
            background: #f44336;
            color: white;
            border-color: #f44336;
        }
        
        .option.selected {
            background: #e3f2fd;
            border-color: #3949ab;
            color: #0d47a1;
        }
        
        .option.selected .option-letter {
            background: #3949ab;
            color: white;
            border-color: #0d47a1;
        }
        
        .feedback {
            padding: 8px 10px;
            border-radius: 8px;
            margin-bottom: 8px;
            display: none;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            font-size: 0.85rem;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            flex-shrink: 0;
        }
        
        .feedback.correct {
            background: #e8f5e9;
            border: 3px solid #4caf50;
            color: #2e7d32;
            display: flex;
        }
        
        .feedback.incorrect {
            background: #ffebee;
            border: 3px solid #f44336;
            color: #c62828;
            display: flex;
        }
        
        .feedback-icon {
            font-size: 1.2rem;
            flex-shrink: 0;
        }
        
        .navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 12px;
            background: #e3f2fd;
            border-top: 2px solid #bbdefb;
            flex-shrink: 0;
            gap: 8px;
        }
        
        .counter {
            font-weight: bold;
            color: #0d47a1;
            font-size: 0.9rem;
            background: white;
            padding: 5px 10px;
            border-radius: 20px;
            border: 2px solid #3949ab;
            box-shadow: 0 3px 6px rgba(0,0,0,0.1);
            flex-shrink: 0;
        }
        
        .btn {
            padding: 8px 12px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.8rem;
            white-space: nowrap;
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #0d47a1, #3949ab);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 16px rgba(13, 71, 161, 0.4);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #5c6bc0, #0d47a1);
            color: white;
        }
        
        .btn-secondary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 16px rgba(92, 107, 192, 0.4);
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #ff9800, #f57c00);
            color: #212529;
        }
        
        .btn-warning:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 16px rgba(255, 152, 0, 0.4);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #f44336, #d32f2f);
            color: white;
        }
        
        .btn-danger:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 16px rgba(244, 67, 54, 0.4);
        }
        
        .rationale {
            background: linear-gradient(135deg, #fff3e0, #ffe0b2);
            border: 3px solid #ff9800;
            border-radius: 10px;
            padding: 10px;
            margin-top: 8px;
            display: none;
            box-shadow: 0 4px 12px rgba(255, 152, 0, 0.2);
            flex-shrink: 0;
            overflow: hidden;
            max-height: 120px;
        }
        
        .rationale.show {
            display: block;
            animation: slideIn 0.5s ease;
        }
        
        .rationale h4 {
            color: #ef6c00;
            margin-bottom: 6px;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.9rem;
        }
        
        .rationale p {
            color: #e65100;
            line-height: 1.4;
            font-size: 0.8rem;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .stats {
            display: flex;
            gap: 6px;
            justify-content: center;
            margin-top: 4px;
            flex-wrap: wrap;
            flex-shrink: 0;
        }
        
        .stat {
            background: rgba(255,255,255,0.2);
            padding: 4px 8px;
            border-radius: 15px;
            font-size: 0.7rem;
            white-space: nowrap;
            border: 1px solid rgba(255,255,255,0.3);
        }
        
        .cancel-selection {
            background: linear-gradient(135deg, #f44336, #d32f2f);
            color: white;
            margin: 0 auto 8px auto;
            display: none;
            box-shadow: 0 4px 10px rgba(244, 67, 54, 0.3);
            flex-shrink: 0;
        }
        
        .cancel-selection:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 16px rgba(244, 67, 54, 0.4);
        }
        
        .cancel-selection.show {
            display: flex;
        }
        
        .multiple-select-instructions {
            text-align: center;
            color: #d32f2f;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 0.8rem;
            background: #fff9c4;
            padding: 6px;
            border-radius: 8px;
            border: 2px solid #fff59d;
            flex-shrink: 0;
        }
        
        .matching-container {
            background: linear-gradient(135deg, #f5f7fa, #e8eaf6);
            border-radius: 8px;
            padding: 10px;
            border: 2px solid #e0e0e0;
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            min-height: 0;
        }
        
        .matching-question {
            font-size: 0.85rem;
            color: #2c3e50;
            font-weight: 500;
            margin-bottom: 10px;
            padding: 8px;
            background: white;
            border-radius: 8px;
            border: 2px solid #e0e0e0;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            max-height: 3em;
            flex-shrink: 0;
        }
        
        .matching-options {
            flex: 1;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 5px;
            overflow: hidden;
            padding: 2px;
            min-height: 0;
        }
        
        .matching-option {
            padding: 8px;
            border: 2px dashed #7986cb;
            border-radius: 6px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s ease;
            font-size: 0.8rem;
            font-weight: 500;
            color: #3949ab;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 40px;
            overflow: hidden;
            line-height: 1.2;
        }
        
        .matching-option:hover {
            background: #f3f4fa;
            border-style: solid;
            border-color: #5c6bc0;
        }
        
        .matching-option.correct {
            background: linear-gradient(135deg, #e8f5e9, #c8e6c9);
            border-color: #4caf50;
            border-style: solid;
            color: #2e7d32;
        }
        
        .matching-option.incorrect {
            background: linear-gradient(135deg, #ffebee, #ffcdd2);
            border-color: #f44336;
            border-style: solid;
            color: #c62828;
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1) !important;
        }
        
        /* Remove all scrollbars */
        .options,
        .matching-options,
        .rationale,
        .container,
        .flashcard,
        body {
            overflow: hidden !important;
            -ms-overflow-style: none !important;
            scrollbar-width: none !important;
        }
        
        .options::-webkit-scrollbar,
        .matching-options::-webkit-scrollbar,
        .rationale::-webkit-scrollbar {
            display: none !important;
            width: 0 !important;
            height: 0 !important;
        }
        
        @media (max-width: 768px) {
            .container {
                height: 98vh;
            }
            
            .section-btn {
                min-width: 100px;
                font-size: 0.7rem;
                padding: 4px 8px;
            }
            
            .matching-options {
                grid-template-columns: 1fr;
            }
            
            .header {
                padding: 10px 12px;
            }
            
            .header h1 {
                font-size: 1.2rem;
            }
            
            .navigation {
                padding: 8px 10px;
                flex-wrap: wrap;
                justify-content: center;
                gap: 6px;
            }
            
            .counter {
                order: -1;
                width: 100%;
                text-align: center;
                margin-bottom: 4px;
                font-size: 0.8rem;
            }
            
            .btn {
                padding: 6px 10px;
                font-size: 0.75rem;
            }
            
            .question {
                font-size: 0.85rem;
            }
            
            .option {
                font-size: 0.8rem;
                padding: 6px 8px;
                min-height: 40px;
            }
            
            .question-icon {
                width: 35px;
                height: 35px;
                font-size: 0.9rem;
            }
            
            .option-letter {
                width: 22px;
                height: 22px;
                font-size: 0.75rem;
            }
        }
        
        @media (max-height: 700px) {
            .container {
                height: 99vh;
            }
            
            .header {
                padding: 8px 10px;
            }
            
            .header h1 {
                font-size: 1.1rem;
            }
            
            .header .subtitle {
                font-size: 0.8rem;
            }
            
            .question-container {
                padding: 10px;
                margin-bottom: 6px;
            }
            
            .question {
                font-size: 0.8rem;
                line-height: 1.3;
            }
            
            .option {
                padding: 6px 8px;
                min-height: 35px;
                font-size: 0.75rem;
            }
            
            .navigation {
                padding: 6px 8px;
            }
            
            .rationale {
                max-height: 80px;
                padding: 8px;
            }
            
            .feedback {
                padding: 6px 8px;
                font-size: 0.75rem;
            }
            
            .option-letter {
                width: 20px;
                height: 20px;
                font-size: 0.7rem;
            }
            
            .stats {
                display: none;
            }
        }
        
        @media (max-height: 600px) {
            .question-container {
                padding: 8px;
            }
            
            .question-icon {
                width: 30px;
                height: 30px;
                font-size: 0.8rem;
            }
            
            .option {
                min-height: 30px;
                padding: 4px 6px;
                font-size: 0.7rem;
            }
            
            .option-letter {
                width: 18px;
                height: 18px;
                font-size: 0.65rem;
            }
            
            .btn {
                padding: 5px 8px;
                font-size: 0.7rem;
            }
            
            .rationale {
                max-height: 60px;
                padding: 6px;
            }
            
            .rationale p {
                font-size: 0.7rem;
                line-height: 1.3;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üß¨ Chapter 03: Hereditary Influences on Health Promotion</h1>
            <div class="subtitle">Child Health Promotion Flashcards - Genetic Blueprint Theme</div>
            <div class="stats">
                <div class="stat">üìö 37 Questions</div>
                <div class="stat">üéØ Immediate Feedback</div>
                <div class="stat">‚úÖ Green/Red System</div>
                <div class="stat">üîÑ Multiple Question Types</div>
            </div>
        </div>
        <div class="progress">
            <div class="progress-bar" id="progressBar"></div>
        </div>
        
        <div class="section-nav">
            <button class="section-btn active" onclick="setSection('multiple-choice')">Multiple Choice (31)</button>
            <button class="section-btn" onclick="setSection('multiple-response')">Multiple Response (6)</button>
            <button class="section-btn" onclick="setSection('matching')">Matching (5)</button>
            <button class="section-btn" onclick="setSection('all')">All Mixed (42)</button>
        </div>
        
        <div class="flashcard">
            <div class="question-container">
                <div class="question-icon" id="questionNumber">1</div>
                <div class="question" id="question"></div>
                <div class="multiple-select-indicator" id="multipleSelectIndicator" style="display: none;">Multiple Answers</div>
            </div>
            
            <div class="multiple-select-instructions" id="multipleSelectInstructions" style="display: none;">
                üí° Select ALL correct answers
            </div>
            
            <div class="options" id="options"></div>
            
            <div class="matching-container" id="matchingContainer" style="display: none;">
                <div class="matching-question" id="matchingQuestion"></div>
                <div class="matching-options" id="matchingOptions"></div>
            </div>
            
            <button class="btn cancel-selection" id="cancelBtn" onclick="cancelSelection()">
                üîÑ Reset
            </button>
            
            <div class="feedback" id="feedback">
                <div class="feedback-icon" id="feedbackIcon"></div>
                <div id="feedbackText"></div>
            </div>
            <div class="rationale" id="rationale">
                <h4>üí° Rationale:</h4>
                <p id="rationaleText"></p>
            </div>
        </div>
        
        <div class="navigation">
            <button class="btn btn-secondary" id="prevBtn" onclick="previousCard()">
                ‚¨ÖÔ∏è Prev
            </button>
            <div class="counter" id="counter">1/31</div>
            <button class="btn btn-warning" id="submitBtn" onclick="submitAnswer()" style="display: none;">
                ‚úÖ Submit
            </button>
            <button class="btn btn-primary" id="nextBtn" onclick="nextCard()">
                Next ‚û°Ô∏è
            </button>
        </div>
    </div>

    <script>
        // Chapter 3 Data - Hereditary Influences
        const sections = {
            'multiple-choice': [
                {
                    question: "Which genetic term refers to a person who possesses one copy of an affected gene and one copy of an unaffected gene and is clinically unaffected?",
                    options: ["Allele", "Carrier", "Pedigree", "Multifactorial"],
                    correct: 1,
                    rationale: "An individual who is a carrier is asymptomatic but possesses a genetic alteration, either in the form of a gene or chromosome change. Alleles are alternative expressions of genes at a different locus. A pedigree is a diagram that describes family relationships. Multifactorial describes a complex interaction of both genetic and environmental factors."
                },
                {
                    question: "Which genetic term refers to the transfer of all or part of a chromosome to a different chromosome after chromosome breakage?",
                    options: ["Trisomy", "Monosomy", "Translocation", "Nondisjunction"],
                    correct: 2,
                    rationale: "Translocation is the transfer of all or part of a chromosome to a different chromosome after chromosome breakage. It can be balanced or unbalanced. Trisomy is an abnormal number of chromosomes with an extra chromosome. Monosomy is when a chromosome is represented by a single copy. Nondisjunction is the failure of chromosomes to separate during cell division."
                },
                {
                    question: "Which is a birth defect or disorder that occurs as a new case in a family and is not inherited?",
                    options: ["Sporadic", "Polygenic", "Monosomy", "Association"],
                    correct: 0,
                    rationale: "Sporadic describes a birth defect previously unidentified in a family. It is not inherited. Polygenic inheritance involves many genes. Monosomy is an abnormal number of chromosomes. A nonrandom cluster of malformations without a specific cause is an association."
                },
                {
                    question: "The nurse is assessing a neonate who was born 1 hour ago to healthy white parents in their early forties. Which finding should be most suggestive of Down syndrome?",
                    options: ["Hypertonia", "Low-set ears", "Micrognathia", "Long, thin fingers and toes"],
                    correct: 1,
                    rationale: "Children with Down syndrome have low-set ears. Infants with Down syndrome have hypotonia, not hypertonia. Micrognathia is common in trisomy 18, not Down syndrome. Children with Down syndrome have short hands with broad fingers."
                },
                {
                    question: "Which abnormality is a common sex chromosome defect?",
                    options: ["Down syndrome", "Turner syndrome", "Marfan syndrome", "Hemophilia"],
                    correct: 1,
                    rationale: "Turner syndrome is caused by an absence of one of the X chromosomes. Down syndrome is caused by trisomy 21. Marfan syndrome is a connective tissue disorder. Hemophilia is a disorder of blood coagulation."
                },
                {
                    question: "Turner syndrome is suspected in an adolescent girl with short stature. What causes this?",
                    options: ["Absence of one of the X chromosomes", "Presence of an incomplete Y chromosome", "Precocious puberty in an otherwise healthy child", "Excess production of both androgens and estrogens"],
                    correct: 0,
                    rationale: "Turner syndrome is caused by an absence of one of the X chromosomes. Most girls who have this disorder have one X chromosome missing from all cells. No Y chromosome is present in individuals with Turner syndrome."
                },
                {
                    question: "Which is a sex chromosome abnormality that is caused by the presence of one or more additional X chromosomes in a male?",
                    options: ["Turner", "Triple X", "Klinefelter", "Trisomy 13"],
                    correct: 2,
                    rationale: "Klinefelter syndrome is characterized by one or more additional X chromosomes. These individuals are tall with male secondary sexual characteristics that may be deficient. Turner syndrome results from absence of an X chromosome."
                },
                {
                    question: "Parents ask the nurse about the characteristics of autosomal dominant inheritance. Which statement is characteristic of autosomal dominant inheritance?",
                    options: ["Females are affected with greater frequency than males.", "Unaffected children of affected individuals will have affected children.", "Each child of a heterozygous affected parent has a 50% chance of being affected.", "Any child of two unaffected heterozygous parents has a 25% chance of being affected."],
                    correct: 2,
                    rationale: "In autosomal dominant inheritance, only one copy of the mutant gene is necessary to cause the disorder. When a parent is affected, there is a 50% chance that the chromosome with the gene for the disorder will be contributed to each pregnancy. Males and females are equally affected."
                },
                {
                    question: "Parents ask the nurse about the characteristics of autosomal recessive inheritance. Which is characteristic of autosomal recessive inheritance?",
                    options: ["Affected individuals have unaffected parents.", "Affected individuals have one affected parent.", "Affected parents have a 50% chance of having an affected child.", "Affected parents will have unaffected children."],
                    correct: 0,
                    rationale: "Parents who are carriers of a recessive gene are asymptomatic. For a child to be affected, both parents must have a copy of the gene, which is passed to the child. Both parents are asymptomatic but can have affected children."
                },
                {
                    question: "Which is characteristic of X-linked recessive inheritance?",
                    options: ["There are no carriers.", "Affected individuals are principally males.", "Affected individuals are principally females.", "Affected individuals will always have affected parents."],
                    correct: 1,
                    rationale: "In X-linked recessive disorders, the affected individuals are usually male. With recessive traits, usually two copies of the gene are needed. Because the male only has one X chromosome, the effect is visible with only one copy. Females are usually only carriers."
                },
                {
                    question: "A father with an X-linked recessive disorder asks the nurse what the probability is that his sons will have the disorder. Which response should the nurse make?",
                    options: ["Male children will be carriers.", "All male children will be affected.", "None of the sons will have the disorder.", "It cannot be determined without more data."],
                    correct: 2,
                    rationale: "When a male has an X-linked recessive disorder, he has one copy of the allele on his X chromosome. The father passes only his Y chromosome (not the X chromosome) to his sons. Therefore, none of his sons will have the X-linked recessive gene."
                },
                {
                    question: "The inheritance of which is X-linked recessive?",
                    options: ["Hemophilia A", "Marfan syndrome", "Neurofibromatosis", "Fragile X syndrome"],
                    correct: 0,
                    rationale: "Hemophilia A is inherited as an X-linked recessive trait. Marfan syndrome and neurofibromatosis are inherited as autosomal dominant disorders. Fragile X is inherited as an X-linked trait."
                },
                {
                    question: "Chromosome analysis of the fetus is usually accomplished through the testing of which?",
                    options: ["Fetal serum", "Maternal urine", "Amniotic fluid", "Maternal serum"],
                    correct: 2,
                    rationale: "Amniocentesis is the most common method to retrieve fetal cells for chromosome analysis. Viable fetal cells are sloughed off into the amniotic fluid, and when a sample is taken, they can be cultured and analyzed."
                },
                {
                    question: "A couple asks the nurse about the optimal time for genetic counseling. They do not plan to have children for several years. When should the nurse recommend they begin genetic counseling?",
                    options: ["As soon as the woman suspects that she may be pregnant", "Whenever they are ready to start their family", "Now, if one of them has a family history of congenital heart disease", "Now, if they are members of a population at risk for certain diseases"],
                    correct: 3,
                    rationale: "Persons who seek genetic evaluation and counseling must first be aware if there is a genetic or potential problem in their families. Genetic testing should be done now if the couple is part of a population at risk."
                },
                {
                    question: "A woman, age 43 years, is 6 weeks pregnant. It is important that she be informed of which?",
                    options: ["The need for a therapeutic abortion", "Increased risk for Down syndrome", "Increased risk for Turner syndrome", "The need for an immediate amniocentesis"],
                    correct: 1,
                    rationale: "Women who are older than age 35 years at the birth of a single child are advised to have prenatal diagnosis. The risk of having a child with Down syndrome increases with maternal age."
                },
                {
                    question: "A couple has given birth to their first child, a boy with a recessive disorder. The genetic counselor tells them that the risk of recurrence is one in four. Which statement is a correct interpretation of this information?",
                    options: ["The risk factor remains the same for each pregnancy.", "The risk factor will change when they have a second child.", "Because the parents have one affected child, the next three children should be unaffected.", "Because the parents have one affected child, the next child is four times more likely to be affected."],
                    correct: 0,
                    rationale: "Each pregnancy has the same risks for an affected child. Because an odds ratio reflects the risk, this does not change over time. The statement by the genetic counselor refers to a probability."
                },
                {
                    question: "A couple expecting their first child has a positive family history for several congenital defects and disorders. The couple tells the nurse that they are opposed to abortion for religious reasons. Which should the nurse consider when counseling the couple?",
                    options: ["The couple should be encouraged to have recommended diagnostic testing.", "The couple needs counseling regarding advantages and disadvantages of pregnancy termination.", "Diagnostic testing is required by law in this situation.", "Diagnostic testing is of limited value if termination of pregnancy is not an option."],
                    correct: 0,
                    rationale: "The benefits of prenatal diagnostic testing extend beyond decisions concerning abortion. If the child has congenital disorders, decisions can be made about fetal surgery if indicated. The couple is counseled about the advantages and disadvantages of prenatal diagnosis."
                },
                {
                    question: "Parents ask the nurse if there was something that should have been done during the pregnancy to prevent their child's cleft lip. Which statement should the nurse give as a response?",
                    options: ["\"This is a type of deformation and can sometimes be prevented.\"", "\"Studies show that taking folic acid during pregnancy can prevent this defect.\"", "\"This is a genetic disorder and has a 25% chance of happening with each pregnancy.\"", "\"The malformation occurs at approximately 5 weeks of gestation; there is no known way to prevent this.\""],
                    correct: 3,
                    rationale: "Cleft lip, an example of a malformation, occurs at approximately 5 weeks of gestation when the developing embryo naturally has two clefts in the area. There is no known way to prevent this defect."
                },
                {
                    question: "The nurse is teaching parents of a child with cri du chat syndrome about this disorder. The nurse understands parents understand the teaching if they make which statement?",
                    options: ["\"This disorder is very common.\"", "\"This is an autosomal recessive disorder.\"", "\"The crying pattern is abnormal and catlike.\"", "\"The child will always have a moon-shaped face.\""],
                    correct: 2,
                    rationale: "Typical of this disease is a crying pattern that is abnormal and catlike. Cri du chat, or cat's cry, syndrome is a rare chromosome deletion syndrome resulting from loss of the small arm of chromosome 5."
                },
                {
                    question: "The nurse is reviewing a client's prenatal history. Which prescribed medication does the nurse understand is not considered a teratogen and prescribed during pregnancy?",
                    options: ["Phenytoin (Dilantin)", "Warfarin (Coumadin)", "Isotretinoin (Accutane)", "Heparin sodium (Heparin)"],
                    correct: 3,
                    rationale: "Teratogens, agents that cause birth defects when present in the prenatal environment, account for the majority of adverse intrauterine effects. Types of teratogens include drugs (phenytoin, warfarin, isotretinoin). Heparin is the anticoagulant used during pregnancy and is not a teratogen."
                },
                {
                    question: "The nurse is teaching student nurses about newborn screening. Which statement made by the student indicates understanding of the teaching?",
                    options: ["\"The newborn screening is not mandatory but voluntary.\"", "\"It is acceptable to layer the blood on the Guthrie paper.\"", "\"The initial specimen should be collected as close to discharge as possible.\"", "\"It is best to collect the specimen before the newborn takes the first feeding.\""],
                    correct: 2,
                    rationale: "Because of early discharge of newborns, recommendations for screening include collecting the initial specimen as close as possible to discharge. Newborn screening tests are mandatory in all 50 U.S. states."
                },
                {
                    question: "A hospitalized school-age child with phenylketonuria (PKU) is choosing foods from the hospital's menu. Which food choice should the nurse discourage the child from choosing?",
                    options: ["Banana", "Milkshake", "Fruit juice", "Corn on the cob"],
                    correct: 1,
                    rationale: "Foods with low phenylalanine levels must be measured to provide the prescribed amount. Most high-protein foods, such as meat and dairy products, are either eliminated or restricted to small amounts."
                },
                {
                    question: "The nurse understands that which occurring soon after birth can indicate cystic fibrosis?",
                    options: ["Murmur", "Hypoglycemia", "Meconium ileus", "Muscle weakness"],
                    correct: 2,
                    rationale: "A symptom of cystic fibrosis is a meconium ileus soon after birth. A murmur can be a sign of congenital heart disease. Hypoglycemia can be a sign of Beckwith-Wiedemann syndrome. Muscle weakness can be a sign of myotonic dystrophy."
                },
                {
                    question: "A newborn has been diagnosed with congenital adrenal hyperplasia. Which assessment finding should the nurse expect?",
                    options: ["Ambiguous genitalia", "Prenatal growth retardation", "An abnormally large tongue", "Legs and arms significantly shorter than torso"],
                    correct: 0,
                    rationale: "A newborn diagnosed with congenital adrenal hyperplasia can have ambiguous genitalia or virilization of female external genitalia caused by elevated androgen levels."
                },
                {
                    question: "Parents of a child with hemophilia A ask the nurse, \"What is the deficiency with this disorder?\" Which correct response should the nurse make?",
                    options: ["\"Hemophilia A has a deficiency in red blood cells.\"", "\"Hemophilia A has a deficiency in platelets.\"", "\"Hemophilia A has a deficiency in factor IX.\"", "\"Hemophilia A has a deficiency in factor VIII.\""],
                    correct: 3,
                    rationale: "Hemophilia A is deficient in factor VIII. Glucose-6-phosphate dehydrogenase deficiency shows low red blood cells. Immunosuppression may be the cause of a deficient number of platelets. Hemophilia B is deficient in factor IX."
                },
                {
                    question: "A child with Prader-Willi syndrome has been hospitalized. Which assessment findings does the nurse expect with this syndrome?",
                    options: ["Nonverbal", "Insatiable hunger", "Abnormal, puppetlike gait", "Paroxysms of inappropriate laughter"],
                    correct: 1,
                    rationale: "Prader-Willi syndrome is characterized by insatiable hunger that can lead to morbid obesity in childhood. Abnormal gait, paroxysms of inappropriate laughter, and nonverbal are characteristics seen in Angelman syndrome."
                },
                {
                    question: "Which ethnic group is at risk for Tay-Sachs disease?",
                    options: ["Black African", "Mediterranean", "Ashkenazi Jewish", "Southern and Southeast Asian"],
                    correct: 2,
                    rationale: "The Ashkenazi Jewish ethnic group is at higher risk for Tay-Sachs disease. The black African, Mediterranean, and Southern and Southeast Asian ethnicities are at higher risk for sickle cell anemia disease."
                },
                {
                    question: "A child has been found to have a deficiency in 3-hydroxy-3-methylglutaryl coenzyme A (HMG-CoA) reductase. Which condition is this child at risk for?",
                    options: ["Increased uric acid", "Hypercholesterolemia", "Increased phenylketones", "Altered oxygen transport"],
                    correct: 1,
                    rationale: "HMG-CoA leads to a disruption of metabolic feedback mechanism and accumulation of end product (cholesterol) with the resulting condition of hypercholesterolemia."
                },
                {
                    question: "Phenylketonuria is a genetic disease that results in the body's inability to correctly metabolize which?",
                    options: ["Glucose", "Thyroxine", "Phenylalanine", "Phenylketones"],
                    correct: 2,
                    rationale: "Phenylketonuria is an inborn error of metabolism caused by a deficiency or absence of the enzyme needed to metabolize the essential amino acid phenylalanine."
                },
                {
                    question: "Early diagnosis of congenital hypothyroidism (CH) and phenylketonuria (PKU) is essential to prevent which?",
                    options: ["Obesity", "Diabetes", "Cognitive impairment", "Respiratory distress"],
                    correct: 2,
                    rationale: "Untreated, both PKU and CH cause cognitive impairment. With newborn screening and early intervention, cognitive impairment from these two disorders can be prevented."
                },
                {
                    question: "A breastfed infant has just been diagnosed with galactosemia. The therapeutic management of this includes which?",
                    options: ["Stop breastfeeding the infant.", "Add amino acids to breast milk.", "Substitute a lactose-containing formula for breast milk.", "Give the appropriate enzyme along with breast milk."],
                    correct: 0,
                    rationale: "The infant with galactosemia is fed a diet free of all milk and lactose-containing foods. This includes breast milk. Soy-protein formula is the formula of choice."
                }
            ],
            
            'multiple-response': [
                {
                    question: "Which can be directly attributed to a single-gene disorder? (Select all that apply.)",
                    options: ["Cleft lip", "Cystic fibrosis", "Turner syndrome", "Klinefelter syndrome", "Neurofibromatosis"],
                    correct: [1, 4],
                    rationale: "Cystic fibrosis is a single-gene disorder inherited as an autosomal recessive trait, and neurofibromatosis is a single-gene disorder inherited as an autosomal dominant trait. Cleft lip is classified as a multifactorial disorder. Turner and Klinefelter syndromes are disorders of sex chromosome number."
                },
                {
                    question: "The nurse is reviewing the characteristics of autosomal dominant inheritance. Which are true about these characteristics? (Select all that apply.)",
                    options: ["A carrier state exists.", "The phenotype appears in consecutive generations.", "Males and females are equally likely to be affected.", "Parents who have affected children are usually asymptomatic.", "Children of an affected parent have a 50% chance of being affected."],
                    correct: [1, 2, 4],
                    rationale: "Characteristics of autosomal dominant inheritance include the phenotype appears in consecutive generations, males and females are equally affected, and children of an affected parent have a 50% chance of being affected. A carrier state and parents who have affected children are usually asymptomatic are characteristic of autosomal recessive inheritance."
                },
                {
                    question: "The nurse is reviewing the characteristics of autosomal recessive inheritance. Which are true about these characteristics? (Select all that apply.)",
                    options: ["Most affected persons are males.", "Males and females are equally affected.", "All daughters of an affected male are carriers.", "Carrier parents have a 25% chance of producing an affected child.", "Carrier parents have a 50% chance of producing a carrier child in each pregnancy."],
                    correct: [1, 3, 4],
                    rationale: "Characteristics of autosomal recessive inheritance include males and females are equally affected, carrier parents have a 25% chance of producing an affected child, and carrier parents have a 50% chance of producing a carrier child in each pregnancy. Most affected persons who are males and all daughters of an affected male are carriers are characteristics of X-linked recessive inheritance."
                },
                {
                    question: "Which are signs and symptoms the nurse should assess in the newborn that can indicate an inborn error of metabolism? (Select all that apply.)",
                    options: ["Jaundice", "Strabismus", "Poor feeding", "Acrocyanosis", "Metabolic acidosis"],
                    correct: [0, 2, 4],
                    rationale: "Signs of inborn errors of metabolism include jaundice, poor feeding, and metabolic acidosis. Strabismus and acrocyanosis are normal findings in the newborn."
                },
                {
                    question: "The nurse is interviewing a prenatal client about specific risk factors that are indications for prenatal testing. Which specific risk factors should the nurse note? (Select all that apply.)",
                    options: ["Previous twins", "Inherited disorder", "Previous preterm birth", "Cytomegalovirus infection", "Previous stillbirth or neonatal death"],
                    correct: [1, 3, 4],
                    rationale: "Specific risk factors that are indications for prenatal testing include inherited disorder, cytomegalovirus infection (teratogenic infection), and previous stillbirth or neonatal death. Previous twins or previous preterm birth are not specific risk factors that are indications for prenatal testing."
                },
                {
                    question: "The nurse is teaching nursing students about assessment clues to genetic disorders in the newborn. Which should the nurse include in the teaching session? (Select all that apply.)",
                    options: ["Low-set ears", "Mongolian spots", "Epicanthal folds", "Cephalohematoma", "Forehead prominence"],
                    correct: [0, 2, 4],
                    rationale: "Assessment clues to genetic disorders in the newborn include low-set ears, epicanthal folds, and forehead prominence. Mongolian spots and cephalohematoma are findings in a newborn that are not indicative of a genetic disorder."
                }
            ],
            
            'matching': [
                {
                    question: "Matching Exercise: Match each term with its correct definition.",
                    items: [
                        "Which term refers to the study of chromosomes, with a special focus on chromosome abnormalities?",
                        "Which term describes the complete genetic information of an organism?",
                        "Which term describes a condition in which two individuals have the same genetic trait?",
                        "Which term means 'present at birth'?",
                        "Which term refers to an environmental agent capable of producing a birth defect?"
                    ],
                    options: ["Concordant", "Congenital", "Cytogenetics", "Genome", "Teratogen"],
                    answers: [2, 3, 0, 1, 4],
                    rationales: [
                        "Cytogenetics is the study of chromosomes, with a special focus on chromosome abnormalities.",
                        "Genome describes the complete genetic information of an organism.",
                        "Concordant describes a condition in which two individuals have the same genetic trait.",
                        "Congenital means 'present at birth'.",
                        "Teratogen refers to an environmental agent capable of producing a birth defect."
                    ]
                }
            ]
        };

        let currentSection = 'multiple-choice';
        let currentQuestion = 0;
        let selectedOption = null;
        let selectedOptions = [];
        let isSubmitted = false;
        let answers = {
            'multiple-choice': Array(sections['multiple-choice'].length).fill(null),
            'multiple-response': Array(sections['multiple-response'].length).fill({selected: [], submitted: false}),
            'matching': Array(sections['matching'][0].items.length).fill(null),
            'all': Array(
                sections['multiple-choice'].length + 
                sections['multiple-response'].length + 
                sections['matching'][0].items.length
            ).fill(null)
        };

        function setSection(section) {
            currentSection = section;
            currentQuestion = 0;
            selectedOption = null;
            selectedOptions = [];
            isSubmitted = false;
            
            document.querySelectorAll('.section-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            loadQuestion();
        }

        function isMultipleResponseQuestion() {
            if (currentSection === 'all') {
                const questionData = getCurrentQuestionData();
                return Array.isArray(questionData?.correct);
            }
            return currentSection === 'multiple-response';
        }

        function isMatchingSection() {
            if (currentSection === 'all') {
                const questionData = getCurrentQuestionData();
                return questionData?.isMatching || false;
            }
            return currentSection === 'matching';
        }

        function getCurrentQuestionData() {
            if (currentSection === 'all') {
                if (currentQuestion < sections['multiple-choice'].length) {
                    return {
                        ...sections['multiple-choice'][currentQuestion],
                        section: 'multiple-choice',
                        originalIndex: currentQuestion
                    };
                } else if (currentQuestion < sections['multiple-choice'].length + sections['multiple-response'].length) {
                    const idx = currentQuestion - sections['multiple-choice'].length;
                    return {
                        ...sections['multiple-response'][idx],
                        section: 'multiple-response',
                        originalIndex: idx
                    };
                } else {
                    const idx = currentQuestion - sections['multiple-choice'].length - sections['multiple-response'].length;
                    const matchingData = sections['matching'][0];
                    return {
                        question: matchingData.items[idx],
                        options: matchingData.options,
                        correct: matchingData.answers[idx],
                        rationale: matchingData.rationales ? matchingData.rationales[idx] : matchingData.rationale,
                        isMatching: true,
                        section: 'matching',
                        originalIndex: idx
                    };
                }
            } else if (currentSection === 'matching') {
                const matchingData = sections['matching'][0];
                return {
                    question: matchingData.items[currentQuestion],
                    options: matchingData.options,
                    correct: matchingData.answers[currentQuestion],
                    rationale: matchingData.rationales ? matchingData.rationales[currentQuestion] : matchingData.rationale,
                    isMatching: true
                };
            } else {
                return sections[currentSection][currentQuestion];
            }
        }

        function loadQuestion() {
            const questionData = getCurrentQuestionData();
            
            if (!questionData) return;
            
            const isMatching = questionData.isMatching || false;
            const isMultipleResponse = isMultipleResponseQuestion();
            
            // Update UI elements visibility
            document.getElementById('matchingContainer').style.display = isMatching ? 'flex' : 'none';
            document.getElementById('options').style.display = isMatching ? 'none' : 'flex';
            document.getElementById('multipleSelectIndicator').style.display = isMultipleResponse ? 'block' : 'none';
            document.getElementById('multipleSelectInstructions').style.display = isMultipleResponse ? 'block' : 'none';
            document.getElementById('cancelBtn').classList.remove('show');
            document.getElementById('submitBtn').style.display = isMultipleResponse ? 'flex' : 'none';
            document.getElementById('questionNumber').textContent = currentQuestion + 1;
            
            let totalQuestions;
            if (currentSection === 'all') {
                totalQuestions = sections['multiple-choice'].length + 
                               sections['multiple-response'].length + 
                               sections['matching'][0].items.length;
            } else if (currentSection === 'matching') {
                totalQuestions = sections['matching'][0].items.length;
            } else {
                totalQuestions = sections[currentSection].length;
            }
            
            const progress = ((currentQuestion + 1) / totalQuestions) * 100;
            document.getElementById('progressBar').style.width = `${progress}%`;
            document.getElementById('counter').textContent = `${currentQuestion + 1}/${totalQuestions}`;
            
            if (isMatching) {
                document.getElementById('matchingQuestion').textContent = questionData.question;
                loadMatchingOptions(questionData);
            } else {
                document.getElementById('question').textContent = questionData.question;
                loadOptions(questionData);
            }
            
            document.getElementById('feedback').style.display = 'none';
            document.getElementById('rationale').classList.remove('show');
            
            document.getElementById('prevBtn').disabled = currentQuestion === 0;
            const isLastQuestion = currentQuestion >= totalQuestions - 1;
            document.getElementById('nextBtn').textContent = isLastQuestion ? 'Finish ‚û°Ô∏è' : 'Next ‚û°Ô∏è';
            document.getElementById('nextBtn').disabled = true;
            
            // Load saved answer state
            const storedAnswer = answers[currentSection][currentQuestion];
            if (storedAnswer !== null && storedAnswer !== undefined) {
                if (isMultipleResponse) {
                    selectedOptions = storedAnswer.selected || [];
                    isSubmitted = storedAnswer.submitted || false;
                    
                    if (isSubmitted) {
                        showFeedbackForMultipleResponse(questionData);
                        document.getElementById('nextBtn').disabled = false;
                        document.getElementById('submitBtn').disabled = true;
                    } else {
                        highlightSelectedOptionsForMultipleResponse();
                        document.getElementById('submitBtn').disabled = selectedOptions.length === 0;
                        document.getElementById('nextBtn').disabled = false; // Allow navigation even if not submitted
                        if (selectedOptions.length > 0) {
                            document.getElementById('cancelBtn').classList.add('show');
                        }
                    }
                } else if (isMatching) {
                    selectedOption = storedAnswer;
                    highlightMatchingOption(storedAnswer, questionData);
                    showFeedback(storedAnswer, questionData);
                    document.getElementById('nextBtn').disabled = false;
                    document.getElementById('cancelBtn').classList.add('show');
                } else {
                    selectedOption = storedAnswer;
                    highlightSelectedOption(storedAnswer, questionData);
                    showFeedback(storedAnswer, questionData);
                    document.getElementById('nextBtn').disabled = false;
                    document.getElementById('cancelBtn').classList.add('show');
                }
            } else {
                selectedOption = null;
                selectedOptions = [];
                isSubmitted = false;
                if (isMultipleResponse) {
                    document.getElementById('submitBtn').disabled = true;
                }
            }
        }

        function loadMatchingOptions(questionData) {
            const matchingOptions = document.getElementById('matchingOptions');
            matchingOptions.innerHTML = '';
            
            questionData.options.forEach((option, index) => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'matching-option';
                optionDiv.textContent = `${String.fromCharCode(65 + index)}) ${option}`;
                optionDiv.onclick = () => selectMatchingOption(index, questionData);
                matchingOptions.appendChild(optionDiv);
            });
            
            const storedAnswer = answers[currentSection][currentQuestion];
            if (storedAnswer !== null && storedAnswer !== undefined) {
                highlightMatchingOption(storedAnswer, questionData);
            }
        }

        function loadOptions(questionData) {
            const optionsContainer = document.getElementById('options');
            optionsContainer.innerHTML = '';
            
            questionData.options.forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.className = 'option';
                optionElement.innerHTML = `
                    <div class="option-letter">${String.fromCharCode(65 + index)}</div>
                    <div class="option-text">${option}</div>
                `;
                optionElement.onclick = () => selectOption(index, questionData);
                optionsContainer.appendChild(optionElement);
            });
        }

        function selectOption(index, questionData) {
            if (!questionData) questionData = getCurrentQuestionData();
            
            if (isMultipleResponseQuestion()) {
                handleMultipleResponseSelect(index, questionData);
            } else {
                handleSingleSelect(index, questionData);
            }
        }

        function handleSingleSelect(index, questionData) {
            if (!questionData) questionData = getCurrentQuestionData();
            
            answers[currentSection][currentQuestion] = index;
            selectedOption = index;
            
            highlightSelectedOption(index, questionData);
            showFeedback(index, questionData);
            document.getElementById('nextBtn').disabled = false;
            document.getElementById('cancelBtn').classList.add('show');
        }

        function handleMultipleResponseSelect(index, questionData) {
            if (!questionData) questionData = getCurrentQuestionData();
            if (isSubmitted) return;
            
            const optionIndex = selectedOptions.indexOf(index);
            if (optionIndex === -1) {
                selectedOptions.push(index);
            } else {
                selectedOptions.splice(optionIndex, 1);
            }
            
            const options = document.querySelectorAll('.option');
            options.forEach((option, i) => {
                option.classList.remove('selected', 'correct', 'incorrect');
                if (selectedOptions.includes(i)) {
                    option.classList.add('selected');
                }
            });
            
            // Save the selection
            if (!answers[currentSection][currentQuestion]) {
                answers[currentSection][currentQuestion] = {selected: [], submitted: false};
            }
            answers[currentSection][currentQuestion].selected = selectedOptions;
            answers[currentSection][currentQuestion].submitted = false;
            
            document.getElementById('submitBtn').disabled = selectedOptions.length === 0;
            document.getElementById('nextBtn').disabled = false; // Allow navigation even if not submitted
            document.getElementById('cancelBtn').classList.toggle('show', selectedOptions.length > 0);
        }

        function selectMatchingOption(index, questionData) {
            if (!questionData) questionData = getCurrentQuestionData();
            
            answers[currentSection][currentQuestion] = index;
            selectedOption = index;
            
            // Clear all classes first
            document.querySelectorAll('.matching-option').forEach(option => {
                option.classList.remove('selected', 'correct', 'incorrect');
            });
            
            const selectedOptionElement = document.querySelectorAll('.matching-option')[index];
            selectedOptionElement.classList.add('selected');
            
            if (index === questionData.correct) {
                selectedOptionElement.classList.add('correct');
            } else {
                selectedOptionElement.classList.add('incorrect');
                // Also show the correct answer
                document.querySelectorAll('.matching-option')[questionData.correct].classList.add('correct');
            }
            
            showFeedback(index, questionData);
            document.getElementById('nextBtn').disabled = false;
            document.getElementById('cancelBtn').classList.add('show');
        }

        function highlightMatchingOption(index, questionData) {
            if (!questionData) questionData = getCurrentQuestionData();
            
            const options = document.querySelectorAll('.matching-option');
            
            options.forEach((option, i) => {
                option.classList.remove('selected', 'correct', 'incorrect');
                if (i === index) {
                    option.classList.add('selected');
                    if (i === questionData.correct) {
                        option.classList.add('correct');
                    } else {
                        option.classList.add('incorrect');
                        options[questionData.correct].classList.add('correct');
                    }
                }
            });
        }

        function highlightSelectedOption(index, questionData) {
            if (!questionData) questionData = getCurrentQuestionData();
            
            const options = document.querySelectorAll('.option');
            
            options.forEach((option, i) => {
                option.classList.remove('selected', 'correct', 'incorrect');
                
                if (i === index) {
                    if (i === questionData.correct) {
                        option.classList.add('correct');
                    } else {
                        option.classList.add('incorrect');
                        options[questionData.correct].classList.add('correct');
                    }
                }
            });
        }

        function highlightSelectedOptionsForMultipleResponse() {
            const options = document.querySelectorAll('.option');
            
            options.forEach((option, i) => {
                option.classList.remove('selected', 'correct', 'incorrect');
                if (selectedOptions.includes(i)) {
                    option.classList.add('selected');
                }
            });
        }

        function submitAnswer() {
            if (selectedOptions.length === 0) return;
            
            isSubmitted = true;
            
            if (!answers[currentSection][currentQuestion]) {
                answers[currentSection][currentQuestion] = {selected: [], submitted: false};
            }
            answers[currentSection][currentQuestion].submitted = true;
            
            const questionData = getCurrentQuestionData();
            showFeedbackForMultipleResponse(questionData);
            document.getElementById('nextBtn').disabled = false;
            document.getElementById('submitBtn').disabled = true;
            document.getElementById('cancelBtn').classList.remove('show');
        }

        function showFeedback(index, questionData) {
            if (!questionData) questionData = getCurrentQuestionData();
            
            const feedback = document.getElementById('feedback');
            const feedbackIcon = document.getElementById('feedbackIcon');
            const feedbackText = document.getElementById('feedbackText');
            const rationale = document.getElementById('rationale');
            const rationaleText = document.getElementById('rationaleText');
            
            if (index === questionData.correct) {
                feedback.className = 'feedback correct';
                feedbackIcon.textContent = '‚úÖ';
                feedbackText.textContent = 'Correct! Well done.';
            } else {
                feedback.className = 'feedback incorrect';
                feedbackIcon.textContent = '‚ùå';
                const correctLetter = String.fromCharCode(65 + questionData.correct);
                feedbackText.textContent = `Incorrect. Correct: ${correctLetter}`;
            }
            
            feedback.style.display = 'flex';
            rationaleText.textContent = questionData.rationale;
            rationale.classList.add('show');
        }

        function showFeedbackForMultipleResponse(questionData) {
            if (!questionData) questionData = getCurrentQuestionData();
            
            const feedback = document.getElementById('feedback');
            const feedbackIcon = document.getElementById('feedbackIcon');
            const feedbackText = document.getElementById('feedbackText');
            const rationale = document.getElementById('rationale');
            const rationaleText = document.getElementById('rationaleText');
            
            const allCorrectSelected = questionData.correct.every(c => selectedOptions.includes(c));
            const noIncorrectSelected = selectedOptions.every(s => questionData.correct.includes(s));
            
            const options = document.querySelectorAll('.option');
            options.forEach((option, i) => {
                option.classList.remove('selected', 'correct', 'incorrect');
                if (questionData.correct.includes(i)) {
                    option.classList.add('correct');
                }
                if (selectedOptions.includes(i) && !questionData.correct.includes(i)) {
                    option.classList.add('incorrect');
                }
            });
            
            if (allCorrectSelected && noIncorrectSelected) {
                feedback.className = 'feedback correct';
                feedbackIcon.textContent = '‚úÖ';
                feedbackText.textContent = 'Perfect! All correct selected.';
            } else if (allCorrectSelected && !noIncorrectSelected) {
                feedback.className = 'feedback incorrect';
                feedbackIcon.textContent = '‚ö†Ô∏è';
                feedbackText.textContent = 'Almost! All correct + some incorrect.';
            } else if (!allCorrectSelected && noIncorrectSelected) {
                feedback.className = 'feedback incorrect';
                feedbackIcon.textContent = '‚ö†Ô∏è';
                feedbackText.textContent = 'Partially correct! Some correct, missed others.';
            } else {
                feedback.className = 'feedback incorrect';
                feedbackIcon.textContent = '‚ùå';
                feedbackText.textContent = 'Incorrect. Missed correct & selected incorrect.';
            }
            
            feedback.style.display = 'flex';
            rationaleText.textContent = questionData.rationale;
            rationale.classList.add('show');
        }

        function cancelSelection() {
            const questionData = getCurrentQuestionData();
            
            if (isMultipleResponseQuestion()) {
                selectedOptions = [];
                isSubmitted = false;
                
                const options = document.querySelectorAll('.option');
                options.forEach(option => {
                    option.classList.remove('selected', 'correct', 'incorrect');
                });
                
                if (answers[currentSection][currentQuestion]) {
                    answers[currentSection][currentQuestion] = {selected: [], submitted: false};
                }
                
                document.getElementById('nextBtn').disabled = true;
                document.getElementById('submitBtn').disabled = true;
                document.getElementById('feedback').style.display = 'none';
                document.getElementById('rationale').classList.remove('show');
                document.getElementById('cancelBtn').classList.remove('show');
            } else if (isMatchingSection()) {
                answers[currentSection][currentQuestion] = null;
                selectedOption = null;
                
                document.querySelectorAll('.matching-option').forEach(option => {
                    option.classList.remove('selected', 'correct', 'incorrect');
                });
                
                document.getElementById('feedback').style.display = 'none';
                document.getElementById('rationale').classList.remove('show');
                document.getElementById('nextBtn').disabled = true;
                document.getElementById('cancelBtn').classList.remove('show');
            } else {
                answers[currentSection][currentQuestion] = null;
                selectedOption = null;
                
                const options = document.querySelectorAll('.option');
                options.forEach(option => {
                    option.classList.remove('selected', 'correct', 'incorrect');
                });
                
                document.getElementById('feedback').style.display = 'none';
                document.getElementById('rationale').classList.remove('show');
                document.getElementById('nextBtn').disabled = true;
                document.getElementById('cancelBtn').classList.remove('show');
            }
        }

        function nextCard() {
            const totalQuestions = getTotalQuestions();
            
            if (currentQuestion < totalQuestions - 1) {
                currentQuestion++;
                selectedOption = null;
                selectedOptions = [];
                isSubmitted = false;
                loadQuestion();
            } else {
                let correctCount = 0;
                let totalAnswered = 0;
                
                Object.keys(answers).forEach(section => {
                    answers[section].forEach((answer, index) => {
                        if (answer !== null) {
                            totalAnswered++;
                            const questionData = getQuestionData(section, index);
                            
                            if (Array.isArray(questionData?.correct)) {
                                if (answer.submitted && Array.isArray(answer.selected)) {
                                    const allCorrect = questionData.correct.every(c => answer.selected.includes(c));
                                    const noIncorrect = answer.selected.every(s => questionData.correct.includes(s));
                                    if (allCorrect && noIncorrect) correctCount++;
                                }
                            } else if (questionData?.isMatching) {
                                if (answer === questionData.correct) correctCount++;
                            } else {
                                if (answer === questionData?.correct) correctCount++;
                            }
                        }
                    });
                });
                
                alert(`Quiz completed!\n\nAnswered: ${totalAnswered}\nCorrect: ${correctCount}\n\nClick OK to restart.`);
                
                currentSection = 'multiple-choice';
                currentQuestion = 0;
                selectedOption = null;
                selectedOptions = [];
                isSubmitted = false;
                answers = {
                    'multiple-choice': Array(sections['multiple-choice'].length).fill(null),
                    'multiple-response': Array(sections['multiple-response'].length).fill({selected: [], submitted: false}),
                    'matching': Array(sections['matching'][0].items.length).fill(null),
                    'all': Array(
                        sections['multiple-choice'].length + 
                        sections['multiple-response'].length + 
                        sections['matching'][0].items.length
                    ).fill(null)
                };
                
                setSection('multiple-choice');
            }
        }

        function previousCard() {
            if (currentQuestion > 0) {
                currentQuestion--;
                const storedAnswer = answers[currentSection][currentQuestion];
                
                if (isMultipleResponseQuestion()) {
                    selectedOptions = storedAnswer?.selected || [];
                    isSubmitted = storedAnswer?.submitted || false;
                } else {
                    selectedOption = storedAnswer;
                }
                
                loadQuestion();
            }
        }

        function getTotalQuestions() {
            if (currentSection === 'all') {
                return sections['multiple-choice'].length + 
                       sections['multiple-response'].length + 
                       sections['matching'][0].items.length;
            } else if (currentSection === 'matching') {
                return sections['matching'][0].items.length;
            } else {
                return sections[currentSection].length;
            }
        }

        function getQuestionData(section, index) {
            if (section === 'all') {
                if (index < sections['multiple-choice'].length) {
                    return sections['multiple-choice'][index];
                } else if (index < sections['multiple-choice'].length + sections['multiple-response'].length) {
                    return sections['multiple-response'][index - sections['multiple-choice'].length];
                } else {
                    const matchingIndex = index - sections['multiple-choice'].length - sections['multiple-response'].length;
                    const matchingData = sections['matching'][0];
                    return {
                        question: matchingData.items[matchingIndex],
                        options: matchingData.options,
                        correct: matchingData.answers[matchingIndex],
                        rationale: matchingData.rationales ? matchingData.rationales[matchingIndex] : matchingData.rationale,
                        isMatching: true
                    };
                }
            } else if (section === 'matching') {
                const matchingData = sections['matching'][0];
                return {
                    question: matchingData.items[index],
                    options: matchingData.options,
                    correct: matchingData.answers[index],
                    rationale: matchingData.rationales ? matchingData.rationales[index] : matchingData.rationale,
                    isMatching: true
                };
            } else {
                return sections[section][index];
            }
        }

        // Initialize
        setSection('multiple-choice');
        
        // Keyboard shortcuts
        document.addEventListener('keydown', function(event) {
            if (event.key >= '1' && event.key <= '5') {
                const index = parseInt(event.key) - 1;
                const questionData = getCurrentQuestionData();
                if (!isMatchingSection()) {
                    selectOption(index, questionData);
                }
            } else if (event.key >= 'a' && event.key <= 'e') {
                const index = event.key.charCodeAt(0) - 97;
                const questionData = getCurrentQuestionData();
                if (!isMatchingSection()) {
                    selectOption(index, questionData);
                }
            } else if (event.key === 'Enter' && isMultipleResponseQuestion()) {
                if (selectedOptions.length > 0 && !isSubmitted) {
                    submitAnswer();
                }
            } else if (event.key === 'ArrowLeft') {
                if (!document.getElementById('prevBtn').disabled) {
                    previousCard();
                }
            } else if (event.key === 'ArrowRight') {
                if (!document.getElementById('nextBtn').disabled) {
                    nextCard();
                }
            } else if (event.key === ' ' || event.key === 'Spacebar') {
                if (!document.getElementById('nextBtn').disabled && !isMultipleResponseQuestion()) {
                    nextCard();
                }
            } else if (event.key === 'Escape') {
                cancelSelection();
            }
        });
    </script>
</body>
</html>